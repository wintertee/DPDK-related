
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Contiv-VPP架构 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Contiv-vpp网络架构.html" />
    
    
    <link rel="prev" href="浅谈 Kubernetes 中的服务发现.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    README
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    prerequisite
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../prerequisite/apt.html">
            
                <a href="../prerequisite/apt.html">
            
                    
                    apt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../prerequisite/kernel parameters.html">
            
                <a href="../prerequisite/kernel parameters.html">
            
                    
                    kernel parameters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../prerequisite/Docker.html">
            
                <a href="../prerequisite/Docker.html">
            
                    
                    Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../DPDK/DPDK.html">
            
                <a href="../DPDK/DPDK.html">
            
                    
                    DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../DPDK/testpmd.html">
            
                <a href="../DPDK/testpmd.html">
            
                    
                    testpmd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../f-stack/f-stack.html">
            
                <a href="../f-stack/f-stack.html">
            
                    
                    f-stack
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../f-stack/helloworld.html">
            
                <a href="../f-stack/helloworld.html">
            
                    
                    helloworld
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../f-stack/nginx.html">
            
                <a href="../f-stack/nginx.html">
            
                    
                    nginx
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../OVS-DPDK/OVS-DPDK.html">
            
                <a href="../OVS-DPDK/OVS-DPDK.html">
            
                    
                    OVS-DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../OVS-DPDK/pktgen.html">
            
                <a href="../OVS-DPDK/pktgen.html">
            
                    
                    pktgen
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../OVS-DPDK/Docker+OVS-DPDK.html">
            
                <a href="../OVS-DPDK/Docker+OVS-DPDK.html">
            
                    
                    Docker+OVS-DPDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../OVS-DPDK/Docker+ovs.html">
            
                <a href="../OVS-DPDK/Docker+ovs.html">
            
                    
                    OVS-Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../K8s-vpp/README.md">
            
                <span>
            
                    
                    K8s-VPP
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../K8s-vpp/K8s.md">
            
                <span>
            
                    
                    部署k8s集群和Contiv-VPP CNI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../K8s-VPP/Contiv-VPP.html">
            
                <a href="../K8s-VPP/Contiv-VPP.html">
            
                    
                    旧文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../K8s-VPP/VPP.html">
            
                <a href="../K8s-VPP/VPP.html">
            
                    
                    安装VPP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../scripts/">
            
                <a href="../scripts/">
            
                    
                    脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="./">
            
                <a href="./">
            
                    
                    转载
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="Kubernetes网络原理.html">
            
                <a href="Kubernetes网络原理.html">
            
                    
                    Kubernetes网络原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="浅谈 Kubernetes 中的服务发现.html">
            
                <a href="浅谈 Kubernetes 中的服务发现.html">
            
                    
                    浅谈 Kubernetes 中的服务发现
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.3" data-path="Contiv-VPP架构.html">
            
                <a href="Contiv-VPP架构.html">
            
                    
                    Contiv-VPP架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="Contiv-vpp网络架构.html">
            
                <a href="Contiv-vpp网络架构.html">
            
                    
                    Contiv-vpp网络架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="网易轻舟服务网格数据面性能优化实践.html">
            
                <a href="网易轻舟服务网格数据面性能优化实践.html">
            
                    
                    网易轻舟服务网格数据面性能优化实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="Network-conf.html">
            
                <a href="Network-conf.html">
            
                    
                    Ubuntu中的网络配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Contiv-VPP架构</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="architecture">Architecture</h1>
<p><a href="https://contivpp.io/docs/architecture/contiv-vpp-arch/" target="_blank">https://contivpp.io/docs/architecture/contiv-vpp-arch/</a></p>
<p>Contiv-VPP consists of several components, each of them packed and shipped as a Docker container. Two of them deploy on Kubernetes master node only:</p>
<ul>
<li><a href="https://contivpp.io/docs/architecture/contiv-vpp-arch/#contiv-ksr" target="_blank">Contiv KSR</a></li>
<li><a href="https://contivpp.io/docs/architecture/contiv-vpp-arch/#Contiv-CRD-netctl" target="_blank">Contiv CRD + Netctl</a></li>
<li><a href="https://contivpp.io/docs/architecture/contiv-vpp-arch/#contiv-etcd" target="_blank">Contiv ETCD</a></li>
</ul>
<p>and the rest of them deploy on all nodes within the k8s cluster (including the master node):</p>
<ul>
<li><a href="https://contivpp.io/docs/architecture/contiv-vpp-arch/#contiv-vswitch" target="_blank">Contiv vSwitch</a></li>
<li><a href="https://contivpp.io/docs/architecture/contiv-vpp-arch/#contiv-cni" target="_blank">Contiv CNI</a></li>
<li><a href="https://contivpp.io/docs/architecture/contiv-vpp-arch/#contiv-stn" target="_blank">Contiv STN</a></li>
<li><a href="https://contivpp.io/docs/architecture/contiv-vpp-arch/#contivpp-UI" target="_blank">Contivpp UI</a></li>
<li><a href="https://contivpp.io/docs/architecture/contiv-vpp-arch/#contivpp-system-flow" target="_blank">Contivpp System Flow</a></li>
</ul>
<p>The following section briefly describes the individual Contiv components, which are displayed as orange boxes on the picture below:</p>
<p><img src="https://contivpp.io/img/what-is-contiv-vpp/contivpp-v2-arch-new.png" alt="contivpp arch"></p>
<h3 id="contiv-ksr">Contiv KSR</h3>
<p>Contiv KSR (Kubernetes State Reflector)is an agent that subscribes to k8s control plane, watches k8s resources and propagates all relevant cluster-related information into the Contiv ETCD data store. Other Contiv components do not access the k8s API directly, they subscribe to Contiv ETCD instead. For more information on KSR, read the <a href="https://github.com/contiv/vpp/blob/master/cmd/contiv-ksr/README.md" target="_blank">KSR Readme</a>.</p>
<p>Contiv KSR(Kubernetes State Reflector)&#x662F;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#xFF0C;&#x5B83;&#x8BA2;&#x9605;k8s&#x63A7;&#x5236;&#x5E73;&#x9762;&#xFF0C;&#x76D1;&#x89C6;k8s&#x8D44;&#x6E90;&#xFF0C;&#x5E76;&#x5C06;&#x6240;&#x6709;&#x76F8;&#x5173;&#x96C6;&#x7FA4;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x4F20;&#x64AD;&#x5230;Contiv ETCD&#x6570;&#x636E;&#x5B58;&#x50A8;&#x4E2D;&#x3002;&#x5176;&#x4ED6;Contiv&#x7EC4;&#x4EF6;&#x4E0D;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;k8s API&#xFF0C;&#x800C;&#x662F;&#x8BA2;&#x9605;Contiv ETCD&#x3002;&#x6709;&#x5173;KSR&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x9605;&#x8BFB;<a href="https://github.com/contiv/vpp/blob/master/cmd/contiv-ksr/README.md" target="_blank">KSR Readme</a>&#x3002;</p>
<h3 id="contiv-crd-netctl">Contiv CRD netctl</h3>
<p>Contiv CRD handles k8s Custom Resource Definitions defined in k8s API and processes them into configuration in Contiv ETCD. Currently it covers Contiv-specific configuration of individual k8s nodes such as IP address and default gateway, etc. Apart from this functionality, it also runs periodic validation of the topology, and exports the results as another CRD entry. The <code>contiv-netctl</code> tool which sits in the same Docker container can be used to explore runtime state of the cluster, such us current IPAM assignments, VPP state etc., or to execute a debug CLI on any of the VPPs in the cluster.</p>
<p>Contiv CRD&#x5904;&#x7406;k8s API&#x4E2D;&#x5B9A;&#x4E49;&#x7684;k8s&#x81EA;&#x5B9A;&#x4E49;&#x8D44;&#x6E90;&#x5B9A;&#x4E49;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x5904;&#x7406;&#x6210;Contiv ETCD&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x76EE;&#x524D;&#x5B83;&#x6DB5;&#x76D6;&#x4E86;Contiv&#x5BF9;&#x5355;&#x4E2A;k8s&#x8282;&#x70B9;&#x7684;&#x5177;&#x4F53;&#x914D;&#x7F6E;&#xFF0C;&#x5982;IP&#x5730;&#x5740;&#x548C;&#x9ED8;&#x8BA4;&#x7F51;&#x5173;&#x7B49;&#x3002;&#x9664;&#x6B64;&#x529F;&#x80FD;&#x5916;&#xFF0C;&#x5B83;&#x8FD8;&#x4F1A;&#x5B9A;&#x671F;&#x8FD0;&#x884C;&#x62D3;&#x6251;&#x9A8C;&#x8BC1;&#xFF0C;&#x5E76;&#x5C06;&#x7ED3;&#x679C;&#x4F5C;&#x4E3A;&#x53E6;&#x4E00;&#x4E2A;CRD&#x6761;&#x76EE;&#x5BFC;&#x51FA;&#x3002;&#x5750;&#x843D;&#x5728;&#x540C;&#x4E00;&#x4E2A;Docker&#x5BB9;&#x5668;&#x4E2D;&#x7684;contiv-netctl&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x63A2;&#x7D22;&#x96C6;&#x7FA4;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x72B6;&#x6001;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x5F53;&#x524D;&#x7684;IPAM&#x5206;&#x914D;&#x3001;VPP&#x72B6;&#x6001;&#x7B49;&#xFF0C;&#x6216;&#x8005;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;VPP&#x4E0A;&#x6267;&#x884C;&#x8C03;&#x8BD5;CLI&#x3002;</p>
<h3 id="contiv-etcd">Contiv ETCD</h3>
<p>Contiv-VPP uses its own instance of ETCD database for storage of k8s cluster-related data reflected by KSR, which are then accessed by Contiv vSwitch Agents running on individual nodes. Apart from the data reflected by KSR, ETCD also stores persisted VPP configuration of individual vswitches (mainly used to restore the operation after restarts), as well as some more internal metadata.</p>
<p>Contiv-VPP&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;ETCD&#x6570;&#x636E;&#x5E93;&#x5B9E;&#x4F8B;&#x6765;&#x5B58;&#x50A8;KSR&#x53CD;&#x6620;&#x7684;k8s&#x96C6;&#x7FA4;&#x76F8;&#x5173;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x7531;&#x8FD0;&#x884C;&#x5728;&#x5404;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x7684;Contiv vSwitch Agents&#x8BBF;&#x95EE;&#x3002;&#x9664;&#x4E86;KSR&#x53CD;&#x6620;&#x7684;&#x6570;&#x636E;&#xFF0C;ETCD&#x8FD8;&#x5B58;&#x50A8;&#x4E86;&#x5404;&#x4E2A;vSwitch&#x7684;&#x6301;&#x4E45;&#x5316;VPP&#x914D;&#x7F6E;&#xFF08;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x91CD;&#x542F;&#x540E;&#x7684;&#x6062;&#x590D;&#x64CD;&#x4F5C;&#xFF09;&#xFF0C;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x66F4;&#x591A;&#x7684;&#x5185;&#x90E8;&#x5143;&#x6570;&#x636E;&#x3002;</p>
<h3 id="contiv-vswitch">Contiv vSwitch</h3>
<p>vSwitch is the main networking component that provides the connectivity to PODs. It deploys on each node in the cluster, and consists of two main components packed into a single Docker container: VPP and Contiv VPP Agent.</p>
<p>vSwitch&#x662F;&#x4E3A;POD&#x63D0;&#x4F9B;&#x8FDE;&#x63A5;&#x7684;&#x4E3B;&#x8981;&#x7F51;&#x7EDC;&#x7EC4;&#x4EF6;&#xFF0C;&#x5B83;&#x90E8;&#x7F72;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x7531;&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x7EC4;&#x4EF6;&#x7EC4;&#x6210;&#xFF0C;&#x6253;&#x5305;&#x6210;&#x4E00;&#x4E2A;Docker&#x5BB9;&#x5668;&#x3002;&#x5B83;&#x90E8;&#x7F72;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x7531;&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x7EC4;&#x4EF6;&#x6253;&#x5305;&#x6210;&#x4E00;&#x4E2A;Docker&#x5BB9;&#x5668;&#x3002;VPP&#x548C;Contiv VPP Agent&#x3002;</p>
<p><strong>VPP</strong> is the data plane software that provides the connectivity between PODs, host Linux network stack and data-plane NIC interface controlled by VPP:</p>
<ul>
<li>PODs are connected to VPP using TAP interfaces wired between VPP and each POD network namespace, </li>
<li>host network stack is connected to VPP using another TAP interface connected to the main (default) network namespace, </li>
<li>data-plane NIC is controlled directly by VPP using DPDK. Note that this means that this interface is not visible to the host Linux network stack, and the node either needs another management interface for k8s control plane communication, or <a href="https://github.com/contiv/vpp/blob/master/docs/SINGLE_NIC_SETUP.md" target="_blank">STN (Steal The NIC)</a> deployment must be applied.</li>
</ul>
<p><strong>VPP</strong>&#x662F;&#x6570;&#x636E;&#x5E73;&#x9762;&#x8F6F;&#x4EF6;&#xFF0C;&#x63D0;&#x4F9B;POD&#x3001;&#x4E3B;&#x673A;Linux&#x7F51;&#x7EDC;&#x6808;&#x548C;VPP&#x63A7;&#x5236;&#x7684;&#x6570;&#x636E;&#x5E73;&#x9762;NIC&#x63A5;&#x53E3;&#x4E4B;&#x95F4;&#x7684;&#x8FDE;&#x63A5;&#x3002;</p>
<ul>
<li>POD&#x901A;&#x8FC7;VPP&#x4E0E;&#x6BCF;&#x4E2A;POD&#x7F51;&#x7EDC;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E4B;&#x95F4;&#x7684;&#x6709;&#x7EBF;TAP&#x63A5;&#x53E3;&#x4E0E;VPP&#x8FDE;&#x63A5;&#x3002;</li>
<li>&#x4E3B;&#x673A;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#x6808;&#x4F7F;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5230;&#x4E3B;&#xFF08;&#x9ED8;&#x8BA4;&#xFF09;&#x7F51;&#x7EDC;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;TAP&#x63A5;&#x53E3;&#x8FDE;&#x63A5;&#x5230;VPP&#x3002;</li>
<li>&#x6570;&#x636E;&#x9762;&#x7684;&#x7F51;&#x5361;&#x7531;VPP&#x4F7F;&#x7528;DPDK&#x76F4;&#x63A5;&#x63A7;&#x5236;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x5BF9;&#x4E3B;&#x673A;Linux&#x7F51;&#x7EDC;&#x6808;&#x662F;&#x4E0D;&#x53EF;&#x89C1;&#x7684;&#xFF0C;&#x8282;&#x70B9;&#x8981;&#x4E48;&#x9700;&#x8981;&#x53E6;&#x4E00;&#x4E2A;&#x7BA1;&#x7406;&#x63A5;&#x53E3;&#x6765;&#x5B9E;&#x73B0;k8s&#x63A7;&#x5236;&#x5E73;&#x9762;&#x901A;&#x4FE1;&#xFF0C;&#x8981;&#x4E48;&#x5FC5;&#x987B;&#x5E94;&#x7528;STN&#xFF08;Steal The NIC&#xFF09;&#x90E8;&#x7F72;&#x3002;</li>
</ul>
<p><strong>Contiv-VPP Agent</strong> is the control plane part of the vSwitch container. It is responsible for configuring the VPP according to the information gained from ETCD and requests from Contiv STN. It is based on the <a href="https://github.com/ligato/vpp-agent" target="_blank">Ligato VPP Agent</a> code with extensions that are related to k8s. For communication with VPP, it uses VPP binary API messages sent via shared memory using <a href="https://wiki.fd.io/view/GoVPP" target="_blank">GoVPP</a>. For connection with Contiv STN, the agent acts as a GRPC server serving CNI requests forwarded from the Contiv CNI.</p>
<p><strong>Contiv-VPP Agent</strong> &#x662F;vSwitch&#x5BB9;&#x5668;&#x7684;&#x63A7;&#x5236;&#x5E73;&#x9762;&#x90E8;&#x5206;&#x3002;&#x5B83;&#x8D1F;&#x8D23;&#x6839;&#x636E;&#x4ECE;ETCD&#x83B7;&#x5F97;&#x7684;&#x4FE1;&#x606F;&#x548C;Contiv STN&#x7684;&#x8BF7;&#x6C42;&#x914D;&#x7F6E;VPP&#x3002;&#x5B83;&#x57FA;&#x4E8E;<a href="https://github.com/ligato/vpp-agent" target="_blank">Ligato VPP Agent</a>&#x4EE3;&#x7801;&#xFF0C;&#x4E0E;k8s&#x76F8;&#x5173;&#x7684;&#x6269;&#x5C55;&#x3002;&#x5BF9;&#x4E8E;&#x4E0E;VPP&#x7684;&#x901A;&#x4FE1;&#xFF0C;&#x5B83;&#x4F7F;&#x7528;<a href="https://wiki.fd.io/view/GoVPP" target="_blank">GoVPP</a>&#x901A;&#x8FC7;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x53D1;&#x9001;&#x7684;VPP&#x4E8C;&#x8FDB;&#x5236;API&#x6D88;&#x606F;&#x3002;&#x5BF9;&#x4E8E;&#x4E0E;Contiv STN&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x4EE3;&#x7406;&#x4F5C;&#x4E3A;GRPC&#x670D;&#x52A1;&#x5668;&#x670D;&#x52A1;&#x4E8E;&#x4ECE;Contiv CNI&#x8F6C;&#x53D1;&#x7684;CNI&#x8BF7;&#x6C42;&#x3002;</p>
<h3 id="contiv-cni">Contiv CNI</h3>
<p>Contiv CNI is a simple binary that implements the <a href="https://github.com/containernetworking/cni" target="_blank">Container Network Interface</a> API and is being executed by Kubelet upon POD creation and deletion. The CNI binary just packs the request into a GRPC request and forwards it to the Contiv VPP Agent running on the same node, which then processes it (wires/unwires the container) and replies with a response, which is then forwarded back to Kubelet.</p>
<p>Contiv CNI&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#xFF0C;&#x5B83;&#x5B9E;&#x73B0;&#x4E86; <a href="https://github.com/containernetworking/cni" target="_blank">Container Network Interface</a> API&#xFF0C;&#x5E76;&#x5728;POD&#x521B;&#x5EFA;&#x548C;&#x5220;&#x9664;&#x65F6;&#x88AB;Kubelet&#x6267;&#x884C;&#x3002;CNI&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x53EA;&#x662F;&#x5C06;&#x8BF7;&#x6C42;&#x6253;&#x5305;&#x6210;GRPC&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x8F6C;&#x53D1;&#x7ED9;&#x8FD0;&#x884C;&#x5728;&#x540C;&#x4E00;&#x8282;&#x70B9;&#x4E0A;&#x7684;Contiv VPP&#x4EE3;&#x7406;&#xFF0C;&#x7136;&#x540E;&#x7531;&#x5176;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF08;&#x7ED9;&#x5BB9;&#x5668;&#x63A5;&#x7EBF;/&#x89E3;&#x7EBF;&#xFF09;&#xFF0C;&#x5E76;&#x56DE;&#x590D;&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8F6C;&#x53D1;&#x7ED9;Kubelet&#x3002;</p>
<h3 id="contiv-stn">Contiv STN</h3>
<p>As already mentioned, the default setup of Contiv-VPP requires 2 network interfaces per node: one controlled by VPP for data facing PODs and one controlled by the host network stack for k8s control plane communication. In case that your k8s nodes do not provide 2 network interfaces, contivpp.io can work in the single NIC setup, when the interface will be &#x201C;stolen&#x201D; from the host network stack just before starting the VPP and configured with the same IP address on VPP, as well as on the host-VPP interconnect TAP interface, as it had in the host before it. For more information on STN setup, read the <a href="https://github.com/contiv/vpp/blob/master/docs/SINGLE_NIC_SETUP.md" target="_blank">Single NIC Setup README</a>.</p>
<p>&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BF4;&#x8FC7;&#xFF0C;Contiv-VPP&#x7684;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x8981;&#x6C42;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x6709;2&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#xFF1A;&#x4E00;&#x4E2A;&#x7531;VPP&#x63A7;&#x5236;&#xFF0C;&#x7528;&#x4E8E;&#x9762;&#x5411;POD&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E00;&#x4E2A;&#x7531;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;&#x6808;&#x63A7;&#x5236;&#xFF0C;&#x7528;&#x4E8E;k8s&#x63A7;&#x5236;&#x5E73;&#x9762;&#x901A;&#x4FE1;&#x3002;&#x5982;&#x679C;&#x4F60;&#x7684;k8s&#x8282;&#x70B9;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;2&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#xFF0C;contivpp.io&#x53EF;&#x4EE5;&#x5728;&#x5355;&#x7F51;&#x5361;&#x8BBE;&#x7F6E;&#x4E2D;&#x5DE5;&#x4F5C;&#xFF0C;&#x8FD9;&#x65F6;&#x63A5;&#x53E3;&#x5C06;&#x5728;&#x542F;&#x52A8;VPP&#x4E4B;&#x524D;&#x4ECE;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;&#x6808;&#x4E2D; &quot;&#x5077; &quot;&#x51FA;&#x6765;&#xFF0C;&#x5E76;&#x5728;VPP&#x4E0A;&#x914D;&#x7F6E;&#x76F8;&#x540C;&#x7684;IP&#x5730;&#x5740;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x4E3B;&#x673A;-VPP&#x4E92;&#x8FDE;TAP&#x63A5;&#x53E3;&#x4E0A;&#x914D;&#x7F6E;&#x76F8;&#x540C;&#x7684;IP&#x5730;&#x5740;&#xFF0C;&#x5C31;&#x50CF;&#x5B83;&#x4E4B;&#x524D;&#x5728;&#x4E3B;&#x673A;&#x4E2D;&#x4E00;&#x6837;&#x3002;&#x5173;&#x4E8E;STN&#x8BBE;&#x7F6E;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x9605;&#x8BFB;<a href="https://github.com/contiv/vpp/blob/master/docs/SINGLE_NIC_SETUP.md" target="_blank">Single NIC Setup README</a>&#x3002;</p>
<h3 id="contivpp-ui">Contivpp UI</h3>
<p>Contivpp UI is composed of two components. The first is a customized GUI enabling the user to display the k8s cluster including the Contiv-VPP system pods. It also allows access to the configuration (e.g. IPAM), k8s, contivpp and namespace and k8s services mapped to contiv vswitches. The other component is a proxy providing REST APIs to the front-end GUI and per-vswitch APIs to the contiv vswitches deployed in the cluster. The contivpp UI is deployed as a docker container and is optional both in the production and demo systems.</p>
<p>Contivpp UI&#x7531;&#x4E24;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x5B9A;&#x5236;&#x7684;GUI&#xFF0C;&#x4F7F;&#x7528;&#x6237;&#x80FD;&#x591F;&#x663E;&#x793A;k8s&#x96C6;&#x7FA4;&#xFF0C;&#x5305;&#x62EC;Contiv-VPP&#x7CFB;&#x7EDF;Pod&#x3002;&#x5B83;&#x8FD8;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x914D;&#x7F6E;&#xFF08;&#x5982;IPAM&#xFF09;&#x3001;k8s&#x3001;contivpp&#x548C;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4EE5;&#x53CA;&#x6620;&#x5C04;&#x5230;contiv vswitches&#x7684;k8s&#x670D;&#x52A1;&#x3002;&#x53E6;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x662F;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#xFF0C;&#x4E3A;&#x524D;&#x7AEF;GUI&#x63D0;&#x4F9B;REST API&#xFF0C;&#x4E3A;&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;&#x7684;contiv vswitches&#x63D0;&#x4F9B;per-vswitch API&#x3002;contivpp UI&#x4EE5;docker&#x5BB9;&#x5668;&#x7684;&#x5F62;&#x5F0F;&#x90E8;&#x7F72;&#xFF0C;&#x5728;&#x751F;&#x4EA7;&#x548C;&#x6F14;&#x793A;&#x7CFB;&#x7EDF;&#x4E2D;&#x90FD;&#x662F;&#x53EF;&#x9009;&#x7684;&#x3002;</p>
<h3 id="contivpp-flow">Contivpp Flow</h3>
<p><img src="https://contivpp.io/img/what-is-contiv-vpp/contiv-flow.png" alt="contivpp arch"></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="浅谈 Kubernetes 中的服务发现.html" class="navigation navigation-prev " aria-label="Previous page: 浅谈 Kubernetes 中的服务发现">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Contiv-vpp网络架构.html" class="navigation navigation-next " aria-label="Next page: Contiv-vpp网络架构">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Contiv-VPP架构","level":"1.8.3","depth":2,"next":{"title":"Contiv-vpp网络架构","level":"1.8.4","depth":2,"path":"reproduce/Contiv-vpp网络架构.md","ref":"reproduce/Contiv-vpp网络架构.md","articles":[]},"previous":{"title":"浅谈 Kubernetes 中的服务发现","level":"1.8.2","depth":2,"path":"reproduce/浅谈 Kubernetes 中的服务发现.md","ref":"reproduce/浅谈 Kubernetes 中的服务发现.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"reproduce/Contiv-VPP架构.md","mtime":"2021-05-07T16:03:00.105Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-05-07T16:03:26.048Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

